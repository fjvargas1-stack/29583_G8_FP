#include <stdio.h>
#include <string.h>

#define MAX_PRODUCTOS 100
#define MAX_NOMBRE 50

struct Producto {
    int id;
    char nombre[MAX_NOMBRE];
    int cantidad;
    float precio;
};

struct Producto inventario[MAX_PRODUCTOS];
int totalProductos = 0;

void mostrarMenuPrincipal() {
    printf("\n=======================================\n");
    printf("   INVENTARIO PLASTICOS Y ENVASES\n");
    printf("=======================================\n");
    printf("1. Agregar nuevo producto\n");
    printf("2. Ver todos los productos\n");
    printf("3. Buscar producto\n");
    printf("4. Salida de producto (Venta)\n");
    printf("5. Salir del programa\n");
    printf("=======================================\n");
    printf("Opcion: ");
}

void mostrarMenuAgregar() {
    printf("\n--- AGREGAR PRODUCTO ---\n");
}

void mostrarMenuInventario() {
    printf("\n--- LISTA DE PRODUCTOS ---\n");
}

void mostrarMenuBuscar() {
    printf("\n--- BUSCAR PRODUCTO ---\n");
}

void mostrarMenuSalida() {
    printf("\n--- SALIDA DE PRODUCTO ---\n");
}

void agregarProducto() {
    mostrarMenuAgregar();

    if (totalProductos >= MAX_PRODUCTOS) {
        printf("No hay espacio para mas productos.\n");
        return;
    }

    struct Producto p;
    p.id = totalProductos + 1;

    printf("Nombre del producto: ");
    scanf(" %[^\n]", p.nombre);
    printf("Cantidad disponible: ");
    scanf("%d", &p.cantidad);
    printf("Precio unitario: ");
    scanf("%f", &p.precio);

    inventario[totalProductos] = p;
    totalProductos++;
    printf("\nProducto registrado exitosamente!\n");
    printf("Codigo asignado: %d\n", p.id);
}

void mostrarInventario() {
    mostrarMenuInventario();

    if (totalProductos == 0) {
        printf("No hay productos registrados.\n");
        return;
    }

    printf("Total de productos: %d\n\n", totalProductos);

    for(int i = 0; i < totalProductos; i++) {
        printf("Producto #%d\n", i+1);
        printf("Codigo: %d\n", inventario[i].id);
        printf("Nombre: %s\n", inventario[i].nombre);
        printf("Cantidad: %d\n", inventario[i].cantidad);
        printf("Precio: $%.2f\n", inventario[i].precio);
        printf("-------------------\n");
    }
}

void buscarProducto() {
    mostrarMenuBuscar();

    if (totalProductos == 0) {
        printf("No hay productos registrados.\n");
        return;
    }

    char nombreBusqueda[MAX_NOMBRE];
    printf("Ingrese nombre a buscar: ");
    scanf(" %[^\n]", nombreBusqueda);

    int encontrados = 0;

    for(int i = 0; i < totalProductos; i++) {
        if(strstr(inventario[i].nombre, nombreBusqueda) != NULL) {
            printf("\nProducto encontrado:\n");
            printf("Codigo: %d\n", inventario[i].id);
            printf("Nombre: %s\n", inventario[i].nombre);
            printf("Cantidad: %d\n", inventario[i].cantidad);
            printf("Precio: $%.2f\n", inventario[i].precio);
            encontrados++;
        }
    }

    if(encontrados == 0) {
        printf("\nNo se encontraron productos.\n");
    } else {
        printf("\nSe encontraron %d producto(s).\n", encontrados);
    }
}

void salidaProducto() {
    mostrarMenuSalida();

    if (totalProductos == 0) {
        printf("No hay productos registrados.\n");
        return;
    }

    int idProducto, cantidadVender;

    printf("Codigo del producto a vender: ");
    scanf("%d", &idProducto);

    // Buscar el producto por ID
    int indice = -1;
    for(int i = 0; i < totalProductos; i++) {
        if(inventario[i].id == idProducto) {
            indice = i;
            break;
        }
    }

    if(indice == -1) {
        printf("Producto no encontrado.\n");
        return;
    }

    printf("\nProducto seleccionado:\n");
    printf("Nombre: %s\n", inventario[indice].nombre);
    printf("Cantidad actual: %d\n", inventario[indice].cantidad);
    printf("Precio: $%.2f\n", inventario[indice].precio);

    printf("\nCantidad a vender: ");
    scanf("%d", &cantidadVender);

    if(cantidadVender <= 0) {
        printf("Cantidad no valida.\n");
        return;
    }

    if(cantidadVender > inventario[indice].cantidad) {
        printf("No hay suficiente stock.\n");
        printf("Stock disponible: %d\n", inventario[indice].cantidad);
        return;
    }

    // Calcular el total de la venta
    float totalVenta = cantidadVender * inventario[indice].precio;

    // Reducir la cantidad en inventario
    inventario[indice].cantidad -= cantidadVender;

    printf("\n=== VENTA REALIZADA ===\n");
    printf("Producto: %s\n", inventario[indice].nombre);
    printf("Cantidad vendida: %d\n", cantidadVender);
    printf("Precio unitario: $%.2f\n", inventario[indice].precio);
    printf("Total venta: $%.2f\n", totalVenta);
    printf("Nuevo stock: %d\n", inventario[indice].cantidad);

    // Si el stock queda en 0, mostrar advertencia
    if(inventario[indice].cantidad == 0) {
        printf("Â¡ADVERTENCIA! Stock agotado.\n");
    }
}

int main() {
    int opcion;

    do {
        mostrarMenuPrincipal();
        scanf("%d", &opcion);

        switch(opcion) {
            case 1:
                agregarProducto();
                break;
            case 2:
                mostrarInventario();
                break;
            case 3:
                buscarProducto();
                break;
            case 4:
                salidaProducto();
                break;
            case 5:
                printf("\nGracias por usar el sistema. Hasta pronto!\n");
                break;
            default:
                printf("\nOpcion incorrecta. Intente de nuevo.\n");
        }
    } while(opcion != 5);

    return 0;
}
